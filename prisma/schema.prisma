generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Admin {
  adminId   String   @id @default(auto()) @map("_id") @db.ObjectId
  username  String   @unique //username
  name      String //à¸Šà¸·à¹ˆà¸­à¹à¸­à¸”à¸¡à¸´à¸™
  password  String //à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  roomsCreated Room[] @relation("RoomCreatedBy")
  roomsUpdated Room[] @relation("RoomUpdatedBy")
  billsCreated Bill[] @relation("BillCreatedBy")
  billsUpdated Bill[] @relation("BillUpdatedBy")
}

model Room {
  roomId     String   @id @default(auto()) @map("_id") @db.ObjectId
  number     String   @unique //à¹€à¸¥à¸‚à¸«à¹‰à¸­à¸‡
  size       String //à¸‚à¸™à¸²à¸”à¸‚à¸­à¸‡à¸«à¹‰à¸­à¸‡
  rent       Int //à¸„à¹ˆà¸²à¹€à¸Šà¹ˆà¸²à¸«à¹‰à¸­à¸‡
  deposit    Int //à¸„à¹ˆà¸²à¸›à¸£à¸°à¸à¸±à¸™à¸«à¹‰à¸­à¸‡
  bookingFee Int //à¸„à¹ˆà¸²à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡
  status     Int // 0 = à¸§à¹ˆà¸²à¸‡, 1 = à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸‡
  createdAt  DateTime @default(now())
  createdBy  String   @db.ObjectId //à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸”à¸¢à¹ƒà¸„à¸£
  updatedAt  DateTime @updatedAt
  updatedBy  String?  @db.ObjectId //à¹à¸à¹‰à¹„à¸‚à¹‚à¸”à¸¢à¹ƒà¸„à¸£

  adminCreated Admin? @relation("RoomCreatedBy", fields: [createdBy], references: [adminId])
  adminUpdated Admin? @relation("RoomUpdatedBy", fields: [updatedBy], references: [adminId])

  bookings Booking[]
  bills    Bill[]
}

model Customer {
  customerId String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String   @unique // LINE LIFF userId
  userName   String // LINE LIFF displayName
  ctitle     String // à¸„à¸³à¸™à¸³à¸«à¸™à¹‰à¸²à¸Šà¸·à¹ˆà¸­
  cname      String //à¸Šà¸·à¹ˆà¸­
  csurname   String //à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥
  fullName   String // à¸Šà¸·à¹ˆà¸­à¹€à¸•à¹‡à¸¡ ctitle + cname + csurname
  cphone     String //à¹€à¸šà¸­à¸£à¹‚à¸—à¸£
  cmumId     String //à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  bookings Booking[]
  bills    Bill[]
}

model Booking {
  bookingId    String    @id @default(auto()) @map("_id") @db.ObjectId
  roomId       String    @db.ObjectId 
  customerId   String    @db.ObjectId
  slipUrl      String?  //à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸› à¹à¸šà¸š Url
  checkin      DateTime //à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸žà¸±à¸
  checkout     DateTime? //à¸à¸²à¸£à¸­à¸­à¸
  status       Int  // 0 = à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ , 1 = à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸­à¸‡ , 2 = à¹„à¸¡à¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸­à¸‡
  returnStatus Int? // 0 = à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ , 1 = à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸à¸²à¸£à¸„à¸·à¸™ , 2 = à¹„à¸¡à¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸à¸²à¸£à¸„à¸·à¸™
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  room     Room     @relation(fields: [roomId], references: [roomId])
  customer Customer @relation(fields: [customerId], references: [customerId])
}

model Bill {
  billId    String   @id @default(auto()) @map("_id") @db.ObjectId
  number    String   @unique
  month     DateTime
  rent      Int
  service   Int
  wBefore   Int
  wAfter    Int
  wUnits    Int
  wPrice    Int
  eBefore   Int
  eAfter    Int
  eUnits    Int
  ePrice    Int
  fine      Int
  total     Int
  slipUrl   String
  status    Int      @default(0) // 0=à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸Šà¸³à¸£à¸°, 1=à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // FK -> Room
  roomId String @db.ObjectId
  room   Room   @relation(fields: [roomId], references: [roomId])

  // FK -> Customer
  customerId String   @db.ObjectId
  customer   Customer @relation(fields: [customerId], references: [customerId])

  // FK -> Admin
  createdBy    String  @db.ObjectId
  updatedBy    String? @db.ObjectId
  adminCreated Admin?  @relation("BillCreatedBy", fields: [createdBy], references: [adminId])
  adminUpdated Admin?  @relation("BillUpdatedBy", fields: [updatedBy], references: [adminId])

  payment Payment?
}

model Payment {
  paymentId String   @id @default(auto()) @map("_id") @db.ObjectId
  billId    String   @unique @db.ObjectId // ðŸ‘ˆ à¸šà¸±à¸‡à¸„à¸±à¸šà¹„à¸¡à¹ˆà¹ƒà¸«à¹‰à¸‹à¹‰à¸³ (1 à¸šà¸´à¸¥ = 1 Payment)
  slipUrl   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bill Bill @relation(fields: [billId], references: [billId])
}
