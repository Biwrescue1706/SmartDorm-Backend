generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Admin {
  adminId   String   @id @default(auto()) @map("_id") @db.ObjectId
  username  String   @unique
  name      String
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  roomsCreated Room[] @relation("RoomCreatedBy")
  roomsUpdated Room[] @relation("RoomUpdatedBy")
  billsCreated Bill[] @relation("BillCreatedBy")
  billsUpdated Bill[] @relation("BillUpdatedBy")
}

model Room {
  roomId     String   @id @default(auto()) @map("_id") @db.ObjectId
  number     String   @unique
  size       String
  rent       Int
  deposit    Int
  bookingFee Int
  status     Int // 0 = à¸§à¹ˆà¸²à¸‡, 1 = à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸‡
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  createdBy String  @db.ObjectId
  updatedBy String? @db.ObjectId

  adminCreated Admin? @relation("RoomCreatedBy", fields: [createdBy], references: [adminId])
  adminUpdated Admin? @relation("RoomUpdatedBy", fields: [updatedBy], references: [adminId])

  bookings Booking[]
  bills    Bill[]
}

model Customer {
  customerId String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String   @unique // LINE LIFF userId
  userName   String // LINE LIFF displayName
  ctitle     String // à¸„à¸³à¸™à¸³à¸«à¸™à¹‰à¸²à¸Šà¸·à¹ˆà¸­
  cname      String //à¸Šà¸·à¹ˆà¸­
  csurname   String //à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥
  fullName   String // à¸Šà¸·à¹ˆà¸­à¹€à¸•à¹‡à¸¡
  cphone     String //à¹€à¸šà¸­à¸£à¹‚à¸—à¸£
  cmumId     String //à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  bookings Booking[]
  bills    Bill[]
}

model Booking {
  bookingId    String    @id @default(auto()) @map("_id") @db.ObjectId
  roomId       String    @db.ObjectId
  customerId   String    @db.ObjectId
  checkin      DateTime
  checkout     DateTime?
  status       Int
  returnStatus Int?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  room     Room      @relation(fields: [roomId], references: [roomId])
  customer Customer  @relation(fields: [customerId], references: [customerId])
  payments Payment[] // ðŸ‘ˆ Booking 1 à¸¡à¸µà¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢ Payment
}

model Payment {
  paymentId String   @id @default(auto()) @map("_id") @db.ObjectId
  bookingId String   @db.ObjectId
  amount    Float?
  slipUrl   String? // ðŸ‘ˆ à¹€à¸à¹‡à¸šà¸ªà¸¥à¸´à¸›à¸—à¸µà¹ˆà¸™à¸µà¹ˆ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  booking Booking @relation(fields: [bookingId], references: [bookingId])
  Bill    Bill?
}

model Bill {
  billId    String   @id @default(auto()) @map("_id") @db.ObjectId
  number    String   @unique
  month     DateTime
  rent      Int
  service   Int
  wBefore   Int
  wAfter    Int
  wUnits    Int
  wPrice    Int
  eBefore   Int
  eAfter    Int
  eUnits    Int
  ePrice    Int
  fine      Int
  total     Int
  slipUrl   String
  status    Int      @default(0) // 0=à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸Šà¸³à¸£à¸°, 1=à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // FK -> Room
  roomId String @db.ObjectId
  room   Room   @relation(fields: [roomId], references: [roomId])

  // FK -> Customer
  customerId String   @db.ObjectId
  customer   Customer @relation(fields: [customerId], references: [customerId])

  // FK -> Admin
  createdBy    String  @db.ObjectId
  updatedBy    String? @db.ObjectId
  adminCreated Admin?  @relation("BillCreatedBy", fields: [createdBy], references: [adminId])
  adminUpdated Admin?  @relation("BillUpdatedBy", fields: [updatedBy], references: [adminId])

  // FK -> Payment
  paymentId String?  @unique @db.ObjectId
  payment   Payment? @relation(fields: [paymentId], references: [paymentId])
}
